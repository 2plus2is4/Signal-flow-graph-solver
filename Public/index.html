<!DOCTYPE html>
<html>
<head>
    <title>HEllo</title>
    <script type="text/javascript" src="vis/dist/vis.js"></script>
    <link href="vis/dist/vis.css" rel="stylesheet" type="text/css">
    <script type="text/javascript" src="jquery/dist/jquery.js"></script>
    <script type="text/javascript" src="graphlib.min.js"></script>
    <script type="text/javascript" src="underscore-min.js"></script>
    <script type="text/javascript" src="additional.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!--<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <!--<style type="text/css">-->
        <!--#graph {-->
            <!--width: 800px;-->
            <!--height: 600px;-->
            <!--border: 1px solid lightgray;-->
            <!--margin: 0 auto;-->
        <!--}-->
    <!--</style>-->
    <style>

        #graph {
            width: 1530px;
            height: 700px;
            border: 1px solid #444444;
            background-color: #222222;
        }
    </style>
</head>
<body>
<div id="input"></div>
<div id="graph"></div>


<script type="text/javascript">
    //imported.src = 'graphlib.m';
    //var bs = require('bootstrap');

    Graph = graphlib.Graph;
    var g = new Graph();
    var firstNode;
    var counter =0;
    var addNode = function (data, callback) {

        if(counter === 0) {
            var count = Number(prompt("please specify how many nodes are you planning to put: "));
        }
        console.log(count);

            var label = prompt("enter the node name: ");
        if (!label) {
            return;
        }
        data.label = label;
        $.post("api/node", data, function (result) {
            callback(data);
        });
        //var myJSON = JSON.stringify(data);
        if(firstNode==null){
            firstNode = data;
            data.fixed=true;
        }else if(counter === count){
            data.fixed=true;
        }
        g.setNode(data.id, data.label);
        console.log(g.nodes());
        //console.log(myJSON);
        counter++;
    };

    var editNode = function (data, callback) {
        var label = prompt("enter the node name: ", data.label);
        if (!label) {
            return;
        }
        data.label = label;
        $.ajax({
            method: "put",
            url: "/api/node",
            data: data,
            success: function (result) {
                callback(result);
            }
        });
        g.setNode(data.id, data.label);
        console.log(g.nodes());
    };

    var deleteNode = function (data, callback) {
        $.ajax({
            method: "delete",
            url: "/api/node",
            data: {node: data.nodes[0]},
            success: function (result) {
                callback(result);
            }
        });

        g.removeNode(data.id);
        console.log(g.nodes());
        console.log(g.removeNode(data.id));
    };

    var addEdge = function (data, callback) {
        var label = prompt("enter the edge name: ");
        if (!label) {
            return;
        }
        data.label = label;
        $.post("api/edge", data, function (result) {
            callback(result);
        });
        g.setEdge(data.from, data.to);
        console.log(g.edges());
    };


    var editEdge = function (data, callback) {
        $.ajax({
            method: "put",
            url: "/api/edge",
            data: data,
            success: function (result) {
                callback(result);
            }
        });
        g.setEdge(data.to, data.from, data.label);
        console.log(g.edges());
    };

    var deleteEdge = function (data, callback) {
        $.ajax({
            method: "delete",
            url: "/api/edge",
            data: {edge: data.edges[0]},
            success: function (result) {
                callback(result);
            }
        });
        g.removeEdge(data.to, data.from);
        console.log(g.edges());
    };

    $.get("/api", function (data) {
        data.options.manipulation = {
            addNode: addNode,
            editNode: editNode,
            deleteNode: deleteNode,
            addEdge: addEdge,
            editEdge: editEdge,
            deleteEdge: deleteEdge
        };
        var container = document.getElementById("graph");
        var network = new vis.Network(container, data, data.options);
        _.each(data.nodes,function (node) {
            g.setNode(node.id,node.label);
        });
        _.each(data.edges,function (edge) {
            g.setEdge(edge.to,edge.from);
        });
    });

    if(firstNode === null){

    }else if(counter===9) {
        console.log(getDeltas());

        console.log(getDelta());
    }


</script>
<button type="button" class="btn btn-secondary btn-lg btn-block">Solve Flow Graph</button>
</body>
</html>